<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salon Accounting</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="brand">üíá‚Äç‚ôÄÔ∏è Salon Accounting</div>
    <div class="spacer"></div>
    <label class="vat-toggle">
      VAT mode:
      <select id="globalVatMode">
        <option value="include">Prices include VAT</option>
        <option value="add">Add VAT on top</option>
      </select>
    </label>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="accounting">Accounting</button>
    <button class="tab" data-tab="cost">Cost Analyzer</button>
    <button class="tab" data-tab="reports">Reports</button>
    <button class="tab" data-tab="data">Data</button>
    <button class="tab" data-tab="settings">Settings</button>
  </nav>

  <main>
    <!-- ACCOUNTING TAB -->
    <section id="tab-accounting" class="tab-panel active">
      <div class="grid two">
        <div class="card">
          <h2>Daily Takings</h2>
          <form id="takingsForm">
            <div class="row">
              <label>Date</label>
              <input type="date" id="tkDate" required />
            </div>
            <div class="row">
              <label>Stylist</label>
              <select id="tkStylist"></select>
            </div>
            <div class="row">
              <label>Services (Gross)</label>
              <input type="number" id="tkServicesGross" step="0.01" min="0" value="0" />
            </div>
            <div class="row">
              <label>Retail (Gross)</label>
              <input type="number" id="tkRetailGross" step="0.01" min="0" value="0" />
            </div>
            <div class="row">
              <label>VAT Rate %</label>
              <input type="number" id="tkVatRate" step="0.01" min="0" value="23" />
            </div>
            <div class="row">
              <label>Cash In</label>
              <input type="number" id="tkCash" step="0.01" min="0" value="0" />
            </div>
            <div class="row">
              <label>Card In</label>
              <input type="number" id="tkCard" step="0.01" min="0" value="0" />
            </div>
            <div class="row">
              <label>Vouchers Sold</label>
              <input type="number" id="tkVouchersIn" step="0.01" min="0" value="0" />
            </div>
            <div class="row">
              <label>Voucher Redemptions</label>
              <input type="number" id="tkVouchersOut" step="0.01" min="0" value="0" />
            </div>
            <div class="row">
              <label>Refunds (Gross)</label>
              <input type="number" id="tkRefunds" step="0.01" min="0" value="0" />
            </div>
            <button type="submit">Post Takings</button>
          </form>
        </div>

        <div class="card">
          <h2>Expense</h2>
          <form id="expenseForm">
            <div class="row">
              <label>Date</label>
              <input type="date" id="exDate" required/>
            </div>
            <div class="row">
              <label>Supplier</label>
              <input type="text" id="exSupplier" />
            </div>
            <div class="row">
              <label>Category</label>
              <select id="exCategory"></select>
            </div>
            <div class="row">
              <label>Net Amount</label>
              <input type="number" id="exNet" step="0.01" min="0" value="0" />
            </div>
            <div class="row">
              <label>VAT Rate %</label>
              <input type="number" id="exVatRate" step="0.01" min="0" value="23" />
            </div>
            <div class="row">
              <label>Total (auto)</label>
              <input type="number" id="exTotal" step="0.01" min="0" value="0" disabled />
            </div>
            <button type="submit">Post Expense</button>
          </form>
        </div>
      </div>

      <div class="card kpis">
        <h2>KPIs</h2>
        <div class="grid four">
          <div class="kpi"><div class="kpi-label">Revenue (Gross)</div><div class="kpi-value" id="kpiRevenueGross">‚Ç¨0.00</div></div>
          <div class="kpi"><div class="kpi-label">Revenue (Net of VAT)</div><div class="kpi-value" id="kpiRevenueNet">‚Ç¨0.00</div></div>
          <div class="kpi"><div class="kpi-label">VAT Collected</div><div class="kpi-value" id="kpiVatOut">‚Ç¨0.00</div></div>
          <div class="kpi"><div class="kpi-label">Expenses (Net)</div><div class="kpi-value" id="kpiExpensesNet">‚Ç¨0.00</div></div>
        </div>
      </div>

      <div class="card">
        <h2>Recent Journal Entries</h2>
        <table id="journalTable">
          <thead><tr><th>Date</th><th>Memo</th><th>Lines</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- COST TAB -->
    <section id="tab-cost" class="tab-panel">
      <div class="grid two">
        <div class="card">
          <h2>Service Cost Model</h2>
          <form id="serviceForm">
            <div class="row"><label>Service</label><input id="svcName" placeholder="Full Head Colour" required/></div>
            <div class="row"><label>Price (Net)</label><input type="number" id="svcPriceNet" step="0.01" value="60"/></div>
            <div class="row"><label>Target Margin %</label><input type="number" id="svcTarget" step="0.1" value="65"/></div>
            <div class="row"><label>Labour mins</label><input type="number" id="svcMins" step="1" value="60"/></div>
            <div class="row"><label>Labour rate ‚Ç¨/hr</label><input type="number" id="svcLabourRate" step="0.01" value="20"/></div>
            <div class="row"><label>Overhead ‚Ç¨/service</label><input type="number" id="svcOverhead" step="0.01" value="3"/></div>
            <h3>Materials</h3>
            <div id="materialsList"></div>
            <button id="addMaterial" type="button">+ Add Material</button>
            <button type="submit">Save Analysis</button>
          </form>
        </div>
        <div class="card">
          <h2>Result</h2>
          <div id="costResult"></div>
          <hr/>
          <h3>Saved Analyses</h3>
          <table id="analysisTable">
            <thead><tr><th>Service</th><th>PriceNet</th><th>TrueCost</th><th>Margin%</th><th>Œî vs Target</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- REPORTS TAB -->
    <section id="tab-reports" class="tab-panel">
      <div class="card">
        <h2>Reports</h2>
        <div class="row">
          <label>Period (YYYY-MM)</label>
          <input type="month" id="repPeriod" />
          <button id="runReports">Run</button>
        </div>
        <div class="grid two">
          <div>
            <h3>Profit & Loss</h3>
            <table id="pnlTable"><thead><tr><th>Account</th><th>Amount</th></tr></thead><tbody></tbody></table>
          </div>
          <div>
            <h3>Balance Sheet</h3>
            <table id="bsTable"><thead><tr><th>Account</th><th>Amount</th></tr></thead><tbody></tbody></table>
          </div>
        </div>
        <div class="grid two">
          <div>
            <h3>VAT Summary</h3>
            <table id="vatTable"><thead><tr><th>Type</th><th>Amount</th></tr></thead><tbody></tbody></table>
          </div>
          <div>
            <h3>Commissions</h3>
            <table id="commTable"><thead><tr><th>Stylist</th><th>Commission</th></tr></thead><tbody></tbody></table>
          </div>
        </div>
      </div>
    </section>

    <!-- DATA TAB -->
    <section id="tab-data" class="tab-panel">
      <div class="card">
        <h2>Backup / Restore</h2>
        <div class="row">
          <button id="exportJson">Export JSON</button>
          <input type="file" id="importJson" accept="application/json" />
        </div>
      </div>
    </section>

    <!-- SETTINGS TAB -->
    <section id="tab-settings" class="tab-panel">
      <div class="card">
        <h2>VAT & Accounts</h2>
        <div class="row">
          <label>Default VAT Rate %</label>
          <input type="number" id="setVatRate" step="0.01" value="23" />
          <button id="saveSettings">Save</button>
        </div>
      </div>
      <div class="card">
        <h2>Stylists</h2>
        <form id="stylistForm">
          <div class="row"><label>Name</label><input id="styName" required/></div>
          <div class="row"><label>Commission %</label><input type="number" id="styRate" step="0.01" value="0"/></div>
          <button type="submit">Add Stylist</button>
        </form>
        <table id="stylistTable"><thead><tr><th>Name</th><th>Rate %</th></tr></thead><tbody></tbody></table>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>Local-first PWA ‚Ä¢ Data stays on this device</small>
  </footer>

  <script src="db.js"></script>
  <script src="ledger.js"></script>
  <script src="cost_analyzer.js"></script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
</body>
</html>
