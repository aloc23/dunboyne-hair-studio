<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Salon Accounting</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="modern-dark-theme.css"/>
  <link rel="stylesheet" href="icons.css"/>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <header class="topbar">
    <h1>Salon Accounting</h1>
    <nav class="tabs" id="tabs">
      <button data-tab="takings" class="tab active"><span class="icon icon-sales"></span>Sales & Takings</button>
      <button data-tab="expenses" class="tab"><span class="icon icon-expenses"></span>Expenses</button>
      <button data-tab="catalog" class="tab"><span class="icon icon-catalog"></span>Service Catalog</button>
      <button data-tab="analyzer" class="tab"><span class="icon icon-calculator"></span>Service Analyzer</button>
      <button data-tab="reports" class="tab"><span class="icon icon-reports"></span>Reports</button>
      <button data-tab="staff-costs" class="tab"><span class="icon icon-euro"></span>Staff Costs</button>
      <button data-tab="staff-analysis" class="tab"><span class="icon icon-users"></span>Staff Cost Analysis</button>
      <button data-tab="wages-comparison" class="tab"><span class="icon icon-euro"></span>Wages Comparison</button>
      <button data-tab="settings" class="tab"><span class="icon icon-settings"></span>Settings</button>
    </nav>
  </header>

  <main id="main-content">
    <!-- Sales & Takings -->
    <section id="tab-takings" class="tabpane active">
      <div class="card">
        <h2>Capture Takings</h2>
        <div class="row">
          <label>Date <input type="date" id="takings-date"/></label>
          <label>Mode
            <select id="takings-mode">
              <option value="daily">Daily</option>
              <option value="weekly">Weekly total</option>
            </select>
          </label>
          <label>VAT Mode
            <select id="vat-mode">
              <option value="include">Prices include VAT</option>
              <option value="add">VAT added to prices</option>
            </select>
          </label>
          <label>VAT % <input type="number" step="0.01" id="vat-rate" value="23"/></label>
        </div>

        <h3>Service Lines</h3>
        <table class="table" id="service-lines">
          <thead>
            <tr>
              <th style="width:28%"><span class="icon icon-service"></span> Service</th>
              <th><span class="icon icon-calculator"></span> Qty</th>
              <th><span class="icon icon-euro"></span> Unit Price (€)</th>
              <th><span class="icon icon-euro"></span> Discount (€)</th>
              <th><span class="icon icon-euro"></span> Voucher (€)</th>
              <th><span class="icon icon-euro"></span> Line Total (€)</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button class="btn" id="add-line"><span class="icon icon-add"></span>Add Service</button>

        <div class="row mt">
          <label><span class="icon icon-cash"></span> Retail Gross (€) <input type="number" step="0.01" id="retail-gross" value="0"/></label>
          <label><span class="icon icon-cash"></span> Cash In (€) <input type="number" step="0.01" id="cash-in" value="0"/></label>
          <label><span class="icon icon-card"></span> Card In (€) <input type="number" step="0.01" id="card-in" value="0"/></label>
        </div>

        <div class="kpis" id="takings-kpis"></div>

        <div class="row mt">
          <button class="btn primary" id="post-takings" aria-describedby="takings-help"><span class="icon icon-save"></span>Post Takings</button>
          <button class="btn subtle" id="reset-takings" aria-label="Reset takings form"><span class="icon icon-remove"></span>Reset</button>
        </div>
        <div id="takings-help" class="sr-only">Posts the takings to your accounting records</div>
      </div>
    </section>

    <!-- Expenses -->
    <section id="tab-expenses" class="tabpane">
      <div class="card">
        <h2>Expenses</h2>
        <div class="row">
          <label>Date <input type="date" id="exp-date"></label>
          <label>Category
            <select id="exp-category"></select>
          </label>
          <label>Supplier <input type="text" id="exp-supplier" placeholder="Supplier name"></label>
          <label>Net (€) <input type="number" step="0.01" id="exp-net" value="0"></label>
          <label>VAT % <input type="number" step="0.01" id="exp-vat-rate" value="23"></label>
        </div>
        <div class="row mt">
          <button class="btn primary" id="post-expense" aria-describedby="expense-help"><span class="icon icon-save"></span>Post Expense</button>
          <button class="btn subtle" id="reset-expense" aria-label="Reset expense form"><span class="icon icon-remove"></span>Reset</button>
        </div>
        <div id="expense-help" class="sr-only">Posts the expense to your accounting records</div>
        <div class="row between mt">
          <h3>Recent</h3>
          <button class="btn danger" id="clear-all-expenses" aria-label="Clear all expense entries"><span class="icon icon-remove"></span>Clear All Expenses</button>
        </div>
        <table class="table" id="exp-list">
          <thead><tr><th>Date</th><th>Category</th><th>Supplier</th><th>Net</th><th>VAT</th><th>Total</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Service Catalog -->
    <section id="tab-catalog" class="tabpane">
      <div class="card">
        <div class="row between">
          <h2>Service Catalog</h2>
          <div>
            <button class="btn" id="add-service"><span class="icon icon-add"></span>Add Service</button>
            <button class="btn" id="export-price-list"><span class="icon icon-export"></span>Export Price List</button>
          </div>
        </div>
        <table class="table" id="catalog-table">
          <thead>
            <tr>
              <th>Name</th><th>Price (€)</th><th>Mins</th><th>Products (€)</th><th>Utilities (€)</th><th>Labour (€)</th><th>Total Cost (€)</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Service Analyzer -->
    <section id="tab-analyzer" class="tabpane">
      <div class="card service-analyzer">
        <h2><span class="icon icon-calculator"></span>Service Analyzer</h2>
        <div class="analyzer-controls">
          <div class="form-group">
            <label for="analyzer-service">Select Service</label>
            <select id="analyzer-service">
              <option value="">Choose a service to analyze...</option>
            </select>
            <small class="help-text">Cost breakdown will auto-populate when you select a service</small>
          </div>
        </div>

        <div class="cost-breakdown" id="cost-breakdown" style="display: none;">
          <h4>Cost Breakdown & Analysis</h4>
          
          <div class="cost-breakdown-grid">
            <div class="cost-item">
              <label>Current Price (€)</label>
              <input type="number" step="0.01" id="analyzer-price" placeholder="0.00">
            </div>
            <div class="cost-item">
              <label>Duration (mins)</label>
              <input type="number" id="analyzer-mins" placeholder="0">
            </div>
            <div class="cost-item">
              <label>Products Cost (€)</label>
              <input type="number" step="0.01" id="analyzer-products" placeholder="0.00">
            </div>
            <div class="cost-item">
              <label>Utilities Cost (€)</label>
              <input type="number" step="0.01" id="analyzer-utilities" placeholder="0.00">
            </div>
            <div class="cost-item">
              <label>Labour Cost (€)</label>
              <input type="number" step="0.01" id="analyzer-labour" placeholder="0.00">
            </div>
            <div class="cost-item">
              <label>Target Margin (%)</label>
              <input type="number" step="0.1" id="analyzer-margin" placeholder="0" value="30">
            </div>
          </div>

          <div class="cost-summary" id="cost-summary">
            <div class="summary-item">
              <label>Total Cost</label>
              <div class="value" id="total-cost">€0.00</div>
            </div>
            <div class="summary-item">
              <label>Current Margin</label>
              <div class="value" id="current-margin">0%</div>
            </div>
            <div class="summary-item">
              <label>Recommended Price</label>
              <div class="value" id="recommended-price">€0.00</div>
            </div>
            <div class="summary-item total">
              <label>Profit per Service</label>
              <div class="value" id="profit-per-service">€0.00</div>
            </div>
          </div>

          <div class="analyzer-actions">
            <button class="btn" id="calculate-btn" onclick="calculateAnalysis()">
              <span class="icon icon-calculator"></span>Recalculate
            </button>
            <button class="btn primary" id="save-to-catalog-btn" onclick="saveAnalyzedService()" style="display: none;">
              <span class="icon icon-save"></span>Save to Catalog
            </button>
            <button class="btn" id="reset-analyzer-btn" onclick="resetAnalyzer()">
              <span class="icon icon-remove"></span>Reset
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Reports -->
    <section id="tab-reports" class="tabpane">
      <div class="card">
        <h2>Reports</h2>
        <div class="row">
          <label>From <input type="date" id="rep-from"></label>
          <label>To <input type="date" id="rep-to"></label>
          <button class="btn" id="run-reports"><span class="icon icon-reports"></span>Run</button>
        </div>
        <div id="report-output" class="mt"></div>
        <div class="row mt">
          <label>Month <input type="month" id="close-month"></label>
          <div class="close-month-controls">
            <button class="btn danger" id="close-month-btn" style="display: none;" aria-describedby="close-month-help"><span class="icon icon-warning"></span>Close Month (Post COGS Summary & Lock)</button>
            <div id="close-month-help" class="sr-only">This action permanently locks the selected month and cannot be undone</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Staff Costs -->
    <section id="tab-staff-costs" class="tabpane">
      <div class="card">
        <h2><span class="icon icon-euro"></span>Staff Costs</h2>
        <div class="row">
          <label>Date <input type="date" id="staff-cost-date"></label>
          <label>Staff Member
            <select id="staff-member">
              <option value="">Select staff member...</option>
            </select>
          </label>
          <label>Type
            <select id="staff-cost-type">
              <option value="wages">Regular Wages</option>
              <option value="overtime">Overtime</option>
              <option value="bonus">Bonus</option>
              <option value="commission">Commission</option>
              <option value="holiday-pay">Holiday Pay</option>
              <option value="sick-pay">Sick Pay</option>
              <option value="other">Other</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>Hours Worked <input type="number" step="0.5" id="staff-hours" value="0"></label>
          <label>Rate per Hour (€) <input type="number" step="0.01" id="staff-rate" value="0"></label>
          <label>Additional Amount (€) <input type="number" step="0.01" id="staff-additional" value="0"></label>
          <label>Description <input type="text" id="staff-description" placeholder="Pay period, note, etc."></label>
        </div>
        <div class="row">
          <div class="calculation-display">
            <span>Total Gross: €<span id="staff-gross-total">0.00</span></span>
            <span>VAT: €<span id="staff-vat-amount">0.00</span></span>
            <span>Total Cost: €<span id="staff-total-cost">0.00</span></span>
          </div>
        </div>
        <div class="row mt">
          <button class="btn primary" id="post-staff-cost" aria-describedby="staff-cost-help"><span class="icon icon-save"></span>Post Staff Cost</button>
          <button class="btn subtle" id="reset-staff-cost" aria-label="Reset staff cost form"><span class="icon icon-remove"></span>Reset</button>
        </div>
        <div id="staff-cost-help" class="sr-only">Posts the staff cost to your accounting records as an expense</div>
        
        <div class="row between mt">
          <h3>Recent Staff Costs</h3>
          <button class="btn danger" id="clear-all-staff-costs" aria-label="Clear all staff cost entries"><span class="icon icon-remove"></span>Clear All Staff Costs</button>
        </div>
        <table class="table" id="staff-cost-list">
          <thead>
            <tr>
              <th>Date</th>
              <th>Staff Member</th>
              <th>Type</th>
              <th>Hours</th>
              <th>Rate</th>
              <th class="text-right">Gross (€)</th>
              <th class="text-right">VAT (€)</th>
              <th class="text-right">Total (€)</th>
              <th>Description</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        
        <div class="staff-summary mt">
          <h3>Summary</h3>
          <div class="row">
            <div class="card">
              <h4>This Month</h4>
              <div class="kpis">
                <div class="chip"><strong>Total Hours:</strong> <span id="monthly-staff-hours">0</span></div>
                <div class="chip"><strong>Total Cost:</strong> €<span id="monthly-staff-cost">0.00</span></div>
                <div class="chip"><strong>Average Rate:</strong> €<span id="monthly-avg-rate">0.00</span>/hr</div>
              </div>
            </div>
            <div class="card">
              <h4>Year to Date</h4>
              <div class="kpis">
                <div class="chip"><strong>Total Hours:</strong> <span id="yearly-staff-hours">0</span></div>
                <div class="chip"><strong>Total Cost:</strong> €<span id="yearly-staff-cost">0.00</span></div>
                <div class="chip"><strong>Average Rate:</strong> €<span id="yearly-avg-rate">0.00</span>/hr</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Staff Cost Analysis -->
    <section id="tab-staff-analysis" class="tabpane">
      <div class="card">
        <h2><span class="icon icon-users"></span>Staff Cost Analysis</h2>
        <div class="row">
          <label>From <input type="date" id="staff-from"></label>
          <label>To <input type="date" id="staff-to"></label>
          <button class="btn primary" id="analyze-staff-costs"><span class="icon icon-calculator"></span>Analyze</button>
        </div>
        <div id="staff-analysis-output" class="mt"></div>
      </div>
    </section>

    <!-- Wages Comparison -->
    <section id="tab-wages-comparison" class="tabpane">
      <div class="card">
        <h2><span class="icon icon-euro"></span>Wages Comparison</h2>
        
        <div class="row">
          <div class="chip">
            <strong>Weekly Hours Total:</strong> <span id="total-weekly-hours">0</span>h
          </div>
          <div class="chip">
            <strong>Total Weekly Wage Cost:</strong> €<span id="total-weekly-cost">0.00</span>
          </div>
          <button class="btn primary" id="refresh-comparison"><span class="icon icon-calculator"></span>Update Comparison</button>
        </div>

        <h3>Staff Wages Table</h3>
        <div class="wages-table-container">
          <table class="table" id="wages-table">
            <thead>
              <tr>
                <th>Staff Name</th>
                <th>Default Days</th>
                <th>Hours/Week</th>
                <th>Hourly Rate (€)</th>
                <th>Gross Weekly (€)</th>
                <th>Tax % (€)</th>
                <th>PRSI % (€)</th>
                <th>USC % (€)</th>
                <th>Bonus (€)</th>
                <th>Adjustments (€)</th>
                <th>Net Weekly (€)</th>
                <th>Per Hour Summary (€)</th>
              </tr>
            </thead>
            <tbody id="wages-table-body">
              <!-- Dynamic content will be inserted here -->
            </tbody>
          </table>
        </div>

        <div class="row mt">
          <button class="btn" id="add-staff-member"><span class="icon icon-add"></span>Add Staff Member</button>
          <button class="btn subtle" id="reset-wages"><span class="icon icon-remove"></span>Reset to Defaults</button>
        </div>

        <div class="comparison-section mt">
          <h3>Cost Comparison Analysis</h3>
          <div id="wages-comparison-output">
            <!-- Comparison results will be displayed here -->
          </div>
        </div>
      </div>
    </section>

    <!-- Settings -->
    <section id="tab-settings" class="tabpane">
      <div class="card">
        <h2>Settings</h2>
        <h3>Utilities (€/month)</h3>
        <table class="table" id="utilities-table">
          <thead><tr><th>Name</th><th>€/month</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
        <div class="row mt">
          <button class="btn" id="add-utility"><span class="icon icon-add"></span>Add Utility</button>
          <div class="chip">Total €/hr: <span id="util-eur-hr">0.00</span></div>
        </div>
        <h3 class="mt">Expense Categories</h3>
        <div class="row">
          <input type="text" id="new-cat" placeholder="Add category"/>
          <button class="btn" id="add-cat"><span class="icon icon-add"></span>Add</button>
        </div>
        <ul id="cat-list" class="pilllist mt"></ul>
      </div>
    </section>
  </main>

  <footer class="foot">Local-first • Offline-ready • v0.4</footer>

  <script src="data.js"></script>
  <script src="storage.js"></script>
  <script src="ledger.js"></script>
  <script src="reports.js"></script>
  <script src="staff-analysis.js"></script>
  <script src="staff-costs.js"></script>
  <script src="wages-comparison.js"></script>
  <script src="matrix-nova-enhancements.js"></script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
