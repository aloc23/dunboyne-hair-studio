<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salon Accounting</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css">
  <meta name="theme-color" content="#0f172a">
</head>
<body>
  <header class="app-header">
    <h1>Salon Accounting</h1>
    <nav class="tabs" id="tabs">
      <button data-tab="tab-accounting" class="active">Accounting</button>
      <button data-tab="tab-cost">Cost Analyzer</button>
      <button data-tab="tab-import">Materials Import</button>
      <button data-tab="tab-reports">Reports</button>
      <button data-tab="tab-settings">Settings</button>
      <button data-tab="tab-data">Data</button>
    </nav>
  </header>

  <main>
    <section id="tab-accounting" class="tab active">
      <h2>Daily/Weekly Intake</h2>
      <p class="help">Keep this simple. Enter totals for the day (or a week). Stylist/service breakdown is optional.</p>
      <form id="takings-form" class="card">
        <div class="grid-2">
          <label>Date <input type="date" id="tak-date" required></label>
          <label>Period (optional note) <input type="text" id="tak-note" placeholder="e.g. Week 32"></label>
        </div>
        <div class="grid-3">
          <label>Services Gross (€) <input type="number" step="0.01" id="tak-services" value="0"></label>
          <label>Retail Gross (€) <input type="number" step="0.01" id="tak-retail" value="0"></label>
          <label>Refunds Gross (€) <input type="number" step="0.01" id="tak-refunds" value="0"></label>
        </div>
        <div class="grid-3">
          <label>Cash In (€) <input type="number" step="0.01" id="tak-cash" value="0"></label>
          <label>Card In (€) <input type="number" step="0.01" id="tak-card" value="0"></label>
          <label>Vouchers Sold (€) <input type="number" step="0.01" id="tak-vouchers-in" value="0"></label>
        </div>
        <div class="grid-2">
          <label>Vouchers Redeemed (€) <input type="number" step="0.01" id="tak-vouchers-out" value="0"></label>
          <label>VAT Mode
            <select id="tak-vatmode">
              <option value="include">Prices include VAT</option>
              <option value="add">Add VAT on top</option>
            </select>
          </label>
        </div>
        <details>
          <summary>Optional breakdown by stylist/service</summary>
          <textarea id="tak-detail" placeholder="CSV-like: date,stylist,service,qty,gross"></textarea>
        </details>
        <div class="actions">
          <button type="submit" class="primary">Post Takings</button>
        </div>
      </form>

      <h3>Expense</h3>
      <form id="expense-form" class="card">
        <div class="grid-3">
          <label>Date <input type="date" id="exp-date" required></label>
          <label>Supplier <input type="text" id="exp-supplier" placeholder="Supplier name"></label>
          <label>Category
            <select id="exp-category">
              <option>Consumables</option>
              <option>Rent</option>
              <option>Utilities</option>
              <option>Wages</option>
              <option>Other</option>
            </select>
          </label>
        </div>
        <div class="grid-3">
          <label>Net (€) <input type="number" step="0.01" id="exp-net" value="0"></label>
          <label>VAT % <input type="number" step="0.01" id="exp-vatrate" value="23"></label>
          <label>Total (€) <input type="number" step="0.01" id="exp-total" value="0"></label>
        </div>
        <div class="actions">
          <button type="submit" class="primary">Post Expense</button>
        </div>
      </form>

      <div class="card">
        <h3>Recent Entries</h3>
        <table id="recent-table"></table>
      </div>
    </section>

    <section id="tab-cost" class="tab">
      <h2>Cost Analyzer</h2>
      <form id="cost-form" class="card">
        <div class="grid-2">
          <label>Service Name <input type="text" id="cost-service" required></label>
          <label>Target Margin % <input type="number" id="cost-target" value="70"></label>
        </div>
        <h4>Materials</h4>
        <div id="materials-list"></div>
        <button id="add-material" type="button">+ Add Material</button>
        <div class="grid-3">
          <label>Labour (mins) <input type="number" id="labour-mins" value="45"></label>
          <label>Labour €/hr <input type="number" step="0.01" id="labour-rate" value="20"></label>
          <label>Overhead €/service <input type="number" step="0.01" id="overhead" value="2"></label>
        </div>
        <div class="grid-2">
          <label>Price (gross €) <input type="number" step="0.01" id="price-gross" value="60"></label>
          <label>VAT % <input type="number" step="0.01" id="price-vat" value="23"></label>
        </div>
        <div class="actions">
          <button type="submit" class="primary">Save Analysis</button>
        </div>
        <div id="cost-output" class="output"></div>
      </form>

      <div class="card">
        <h3>Saved Analyses</h3>
        <table id="cost-table"></table>
      </div>
    </section>

    <section id="tab-import" class="tab">
      <h2>Materials Import</h2>
      <div class="card">
        <p>Upload a CSV with columns: service_name,material_name,sku,supplier,units_per_service,unit,pack_size,pack_unit,pack_cost_eur,waste_factor_pct</p>
        <input type="file" id="import-file" accept=".csv">
        <div class="actions">
          <button id="btn-parse" class="primary" type="button">Parse</button>
          <button id="btn-apply" type="button">Apply to Catalog</button>
        </div>
        <div id="import-preview"></div>
      </div>
    </section>

    <section id="tab-reports" class="tab">
      <h2>Reports</h2>
      <div class="card">
        <div class="grid-3">
          <label>From <input type="date" id="rep-from"></label>
          <label>To <input type="date" id="rep-to"></label>
          <button id="btn-run" class="primary" type="button">Run</button>
        </div>
      </div>
      <div class="grid-2">
        <div class="card"><h3>Profit & Loss</h3><div id="pl-table"></div></div>
        <div class="card"><h3>Balance Sheet</h3><div id="bs-table"></div></div>
      </div>
      <div class="card"><h3>VAT Summary</h3><div id="vat-table"></div></div>
    </section>

    <section id="tab-settings" class="tab">
      <h2>Settings</h2>
      <div class="card grid-3">
        <label>Default VAT % <input type="number" step="0.01" id="set-vat" value="23"></label>
        <label>VAT Mode
          <select id="set-vatmode">
            <option value="include">Prices include VAT</option>
            <option value="add">Add VAT on top</option>
          </select>
        </label>
        <button id="btn-save-settings" class="primary">Save</button>
      </div>
    </section>

    <section id="tab-data" class="tab">
      <h2>Data</h2>
      <div class="card">
        <button id="btn-export" class="primary">Export JSON</button>
        <input type="file" id="restore-file" accept="application/json">
        <button id="btn-restore">Restore</button>
      </div>
      <pre id="export-status"></pre>
    </section>
  </main>

  <footer class="footer">
    <small>Salon Accounting MVP — Local PWA • VAT toggle • Double-entry • Cost Analyzer</small>
  </footer>

  <script src="db.js"></script>
  <script src="ledger.js"></script>
  <script src="reports.js"></script>
  <script src="cost.js"></script>
  <script src="importer.js"></script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
